<?php
	include "loghead.php";
?>
<html>
<body>

<h1>Search Cheats & Exploits</h1>
<p>Search by genre, title or ID number.</p>
<form method="post" action="search.php">
    <input type="text" id="search" name="search" />
    <input type="submit" value="Search Genre" name="submit" />
</form>
<form method="post" action="search.php">
	<input type="text" id="search2" name="search2" />
    <input type="submit" value="Search Name" name="submit" />
</form>
<!--<form method="post" action="search.php">
	<input type="text" id="search3" name="search3" />
    <input type="submit" value="Search ID" name="submit" />
</form>-->

<?php
	include "db_connect.php";
	if (isset($_POST['search']))
	{
	?>
	<h2>Results</h2>
	<table border="1">
	<tr><th>ID</th><th>Title</th><th>Genre</th><th>Cheats</th><th>Exploits</th><th>*</th></tr>
	<?php
  		$searchterm = mysqli_real_escape_string($db, trim($_POST['search']));
		
		$query = "SELECT * from game_list WHERE genre LIKE '%$searchterm%'";
		$result = mysqli_query($db, $query) or die("IT DIED!");
		while($row = mysqli_fetch_array($result))
		{
			$id = $row['id'];
			$game = $row['game_name'];
  			$genre = $row['genre'];
  			$cUrl = $row['cheat_url'];
  			$eUrl = $row['exploit_url'];
  			if(!isset($_SESSION['username']))
  			{
				echo "<tr><td>$id</td><td>$game</td><td>$genre</td><td><a href='$cUrl'>Cheats</a>
				</td><td><a href='$eUrl'>Exploits</a></td></tr>\n";
			}
			else
			{
				$name = $_SESSION['username'];
				$query = "Select id from users where username='$name'";
				$result2 = mysqli_query($db,$query) or die("NOOOO");
				$row2 = mysqli_fetch_array($result2);
				$uid = $row2['id'];
				$query = "Select game_name from favorites where user_id='$uid' AND game_name='$game'";
				$result3 = mysqli_query($db,$query) or die("");
				if($row3 = mysqli_fetch_array($result3))
				{
					echo "<tr><td>$id</td><td>$game</td><td>$genre</td><td><a href='$cUrl'>Cheats</a>
					</td><td><a href='$eUrl'>Exploits</a></td><td><a href='unfav.php'>Unfavorite</a></td></tr>\n";
				}
				else
				{
					echo "<tr><td>$id</td><td>$game</td><td>$genre</td><td><a href='$cUrl'>Cheats</a>
					</td><td><a href='$eUrl'>Exploits</a></td><td><a href='fav.php'>Favorite</a></td></tr>\n";
				}
			}
		}
	}
	else if (isset($_POST['search2']))
	{
	?>
	<h2>Results</h2>
	<table border="1">
	<tr><th>ID</th><th>Title</th><th>Genre</th><th>Cheats</th><th>Exploits</th><th>*</th></tr>
	<?php
  		$searchterm = mysqli_real_escape_string($db, trim($_POST['search2']));
		
		$query = "SELECT * from game_list WHERE game_name LIKE '%$searchterm%'";
		$result = mysqli_query($db, $query) or die("IT DIED!");
		while($row = mysqli_fetch_array($result))
		{
			$id = $row['id'];
			$game = $row['game_name'];
  			$genre = $row['genre'];
  			$cUrl = $row['cheat_url'];
  			$eUrl = $row['exploit_url'];
			if(!isset($_SESSION['username']))
  			{
				echo "<tr><td>$id</td><td>$game</td><td>$genre</td><td><a href='$cUrl'>Cheats</a>
				</td><td><a href='$eUrl'>Exploits</a></td></tr>\n";
			}
			else
			{
				$name = $_SESSION['username'];
				$query = "Select id from users where username='$name'";
				$result2 = mysqli_query($db,$query) or die("NOOOO");
				$row2 = mysqli_fetch_array($result2);
				$uid = $row2['id'];
				$query = "Select game_name from favorites where user_id='$uid' AND game_name='$game'";
				$result3 = mysqli_query($db,$query) or die("");
				if($row3 = mysqli_fetch_array($result3))
				{
					echo "<tr><td>$id</td><td>$game</td><td>$genre</td><td><a href='$cUrl'>Cheats</a>
					</td><td><a href='$eUrl'>Exploits</a></td><td><a href='unfav.php'>Unfavorite</a></td></tr>\n";
				}
				else
				{
					echo "<tr><td>$id</td><td>$game</td><td>$genre</td><td><a href='$cUrl'>Cheats</a>
					</td><td><a href='$eUrl'>Exploits</a></td><td><a href='fav.php'>Favorite</a></td></tr>\n";
				}
			}
		}
	}
	/*else if (isset($_POST['search3']))
	{
		$searchterm = mysqli_real_escape_string($db, trim($_POST['search3']));
		
		$query = "SELECT * from game_list WHERE id LIKE '%$searchterm%'";
		$result = mysqli_query($db, $query) or die("IT DIED!");
		while($row = mysqli_fetch_array($result))
		{
			$id = $row['id'];
			$game = $row['game_name'];
  			$genre = $row['genre'];
  			$cUrl = $row['cheat_url'];
  			$eUrl = $row['exploit_url'];
			echo "<tr><td>$id</td><td>$game</td><td>$genre</td><td><a href='$cUrl'>Cheats</a>
			</td><td><a href='$eUrl'>Exploits</a></td></tr>\n";
		}
	}*/
?>
</table>
</body>
</html>