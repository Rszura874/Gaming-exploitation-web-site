<?php
	$host = $_POST['hostname'];
	$user = $_POST['username'];
	$password = $_POST['password'];
	
	$link = mysqli_connect($host, $user, $password);
	//If connection fails, tell the user
	if (!$link) {
		echo( "<P>Unable to connect to the " .
			"database server at this time.</P>" );
		exit();
	}

	if(isset($_POST['replace'])) {
		$query = "DROP DATABASE IF EXISTS games";
		$result = mysqli_query($link, $query) 
			or die ('Invalid query: ' . mysqli_error($link));
	}
	//Database/Table Creation 
	
	$query2 = <<<EOD
	CREATE DATABASE IF NOT EXISTS games;
	USE games;

	CREATE TABLE IF NOT EXISTS game_list
	(
		id int(11) NOT NULL AUTO_INCREMENT,
		game_name varchar(50),
		genre varchar(30),
		url varchar(60),
		PRIMARY KEY(id)
	);

	CREATE TABLE IF NOT EXISTS	users
	(
		id int(11) NOT NULL AUTO_INCREMENT,
		username varchar(50),
		firstname varchar(50),
		lastname varchar(50),
		password varchar(50),
		PRIMARY KEY(id)
	);

	CREATE TABLE IF NOT EXISTS user_favorites
	(
		fav_id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
		user_id int(11),
		game_id int(11),
		CONSTRAINT users_user_id_fk
		FOREIGN KEY (user_id)
		REFERENCES users (id),
		CONSTRAINT game_list_game_id_fk
		FOREIGN KEY (game_id)
		REFERENCES game_list (id)
	);

	CREATE TABLE IF NOT EXISTS systems
	(
		id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
		system_name varchar(20)
	);

	CREATE TABLE IF NOT EXISTS system_matches
	(
		sys_id int(11),
		game_id int(11),
		CONSTRAINT systems_id_fk
		FOREIGN KEY (sys_id)
		REFERENCES systems (id),
		CONSTRAINT game_list_id_fk
		FOREIGN KEY (game_id)
		REFERENCES game_list (id)
	);

	INSERT INTO game_list (game_name, genre, url) VALUES
	('Final Fantasy XIII-2', 'RPG', 'ffXIII-2.txt'),
	('Skyrim', 'RPG', 'skyrim.txt'),
	('Runescape', 'MMO RPG', 'runescape.txt'),
	('Left 4 Dead', 'Shooter', 'left4dead.txt'),
	('Left 4 Dead 2', 'Shooter', 'left4dead2.txt'),
	('Guitar Hero 3: Legends of Rock', 'Music', 'gh3.txt'),
	('Rock Band','Music', 'rb.txt'),
	('Rock Band 2', 'Music', 'rb2.txt'),
	('Disgaea 4', 'RPG', 'd4.txt'),
	('Demon Souls', 'RPG', 'demonsouls.txt'),
	('Kingdom Hearts: Birth by Sleep', 'RPG', 'khbirthbysleep.txt'),
	('Halo Reach', 'Shooter', 'haloreach.txt'),
	('Assassin\'s Creed', 'Action/Adventure', 'assassin.txt');

	INSERT INTO systems (system_name) VALUES
	('PC'),
	('Nintendo 64'),
	('XBOX'),
	('XBOX 360'),
	('Playstation'),
	('Playstation 2'),
	('Playstation 3'),
	('PSP'),
	('Nintendo Wii');

	CREATE INDEX IPK_game_list ON game_list(game_name);
	CREATE INDEX IPK_user_favorites_uid ON user_favorites(user_id);
	CREATE INDEX IPK_user_favorites_gid ON user_favorites(game_id);
EOD;
		$result2 = mysqli_multi_query($link, $query2)
			or die('Invalid query: ' . mysqli_error($link));
			
?>
<html>
<div align=center>Configuration was successful.<br/>

<!-- Homepage button -->
<form method="post" action="home.php">
	<input type="submit" value="Go To Homepage" name="submit" />
</form>
</div>
</html>